---
title: "Untitled"
author: "Enzo Moraes Mescall"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(deSolve)
library(phaseR)
library(tidyverse)
```



```{r}
predator.pray.model = function(t, State, Pars) {
  with(as.list(c(State, Pars)), {
    dPrey = (b * (1 - Prey/(k - eta * Degradation)) - h_0 * Predator - alpha * Poaching) * Prey + m_0 - m * Degradation
    
    dPredator = ( h_1 * (Prey) - d - RetaliatoryKillings - S * Tourism) * Predator
    
    dTourism = A/Tourism - delta * Degradation
    
    dPoaching = gamma * (r_p * Prey - (Omega + sigma_p * (lambda_0 + lambda * Tourism))) * Poaching
    
    dRetaliatoryKillings = c * Predator - B * Tourism
    
    dDegradation = G - E_r - I_0 + (P_t - I_t) * Tourism
  
    equations = c(dPrey, dPredator, dTourism,
                dPoaching, dRetaliatoryKillings, dDegradation)
    
    return(list(equations))
  })
}

# Time vectors, parameters, and initial condition
t = seq(0, 3, 0.01)

Pars = c(gamma = 0.9,   # speed of poaching adjustment
         r_p =  1,      # revenue per poach
         Omega =  1,    # opportunity cost
         sigma_p = 0.7, # risk of poaching
         lambda_0 = 20, # base law enforcement level
         lambda = 0.2,  # law enforcement per investment
         c = 0.1,       # culling rate per predator
         B = 5,         # boma construction per unit invested
         E_r = 50,      # baseline recovery rate
         I_0 = 50,      # baseline government investment
         P_t = 1,       # average pollution per tourist
         I_t = 0.9,       # investment into ecology per tourism income
         G = 1,         # impact of global warming on degradation
         b = 0.3,       # birth rate of prey
         k = 1000,      # carrying capacity of prey
         eta = 10,      # sensitivity of degradation on carrying cap
         h_0 = 0.1,     # effect of hunting on prey population
         alpha = 0.1,   # poaching effectiveness
         m_0 = 0.1,     # baseline migration inwards
         m = 0.01,      # effect of degradation on outwards migration
         h_1 = 0.1,     # conversion of prey biomass into predator biomass
         d = 0.4,       # death rate of predators
         S = 0.1,       # sensitivity of predators to tourist distractions
         delta = 0.5,   # effect of degradation on tourism
         A = 1000)      # tourism destination attractiveness saturation

X_0 = c(Prey = 5,
        Predator = 2,
        Tourism = 1,
        Poaching = 1,
        RetaliatoryKillings = 1,
        Degradation = 1)
```

```{r}
# Calculating where the equilibrium is gonna be

with(as.list(Pars), {
  Tourism = (E_r + I_0 - G)/(P_t - I_t)
  
  Predator = Tourism * B/c
  
  Degradation = Tourism * A/delta
  
  Prey = ()
  
  RetaliatoryKillings = 0
  
  Poaching = 0
  
  c(Prey, Predator, Tourism, Poaching, RetaliatoryKillings, Degradation)
})
```


```{r}
ode(
  func = predator.pray.model,
  y = X_0,
  times = t,
  parms = Pars
) %>% as.data.frame() -> out
```

```{r}
out %>%
gather(variable, value, -time) %>%
ggplot(aes(x = time, y = value, color = variable)) +
    geom_line() +
    labs(x = 'time',y = 'populations')
```

```{r}
flowField = flowField(predator.pray.model,
                      xlim = c(0, 10),
                      ylim = c(0, 10),
                      parameters = Pars,
                      state.names = c("Prey", "Predator"),
                      add = FALSE)

trajectory1 = trajectory(predator.pray.model,
                        y0 = c(5, 2),
                        tlim = c(0, 20),
                        parameters = Pars,
                        state.names = c("Prey", "Predator"),
                        col = "purple")

#nullcline1 = nullclines(predator.pray.model,
#                        xlim = c(0, 170),
#                        ylim = c(0, 500),
#                        parameters = Pars,
#                        state.names = c("Prey", "Predator"))
                          
```





 